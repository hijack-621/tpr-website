<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Program System Create</title>

<style type="text/css">
.intext{
	border:0;
    border-bottom:#000000 1px solid;
}
.words-split label{display: inline-block; padding:0 20px 0 8px; position: relative; margin:3px 4px; }
.words-split label em{display:none; width: 16px; height: 100%; position: absolute; background: #f60;right: 0;top: 0;}
.words-split label em:after{ content: "-"; color: #fff; font: bold 20px 'Microsoft Yahei';}
.words-split label:hover em{ display: block; }
label.words-split-add{display: inline-block;font: bold 20px 'Microsoft Yahei'; color: #2cac93}
.words-split{vertical-align: middle;}
.lbl-input{
	display: inline-block;width: 120px; height: 26px;
	line-height: 26px;
	min-height: 26px;
	text-indent: 1em;
	border: 1px solid #ddd; border-radius: 5px;
	color:#fff;
	vertical-align: middle;
}
.model-lb {
	display: inline-block;
	text-align: center;
	color: #fff;
	height: 28px;
	line-height: 28px;
	font-size: 14px;
	padding: 0 1em;
	border-radius: 3px;
	opacity: .9;
	filter: alpha(opacity=90);
	background:#2cac93;
}
.not-cg{
    margin-left: 5px;
    color: #fff;
}
.station-lb {
    display: inline-block;
    text-align: center;
    color: #fff;
    height: 28px;
    line-height: 28px;
    font-size: 14px;
    padding: 0 1em;
    border-radius: 3px;
    opacity: .9;
    filter: alpha(opacity=90);
    background:#2cac93;
}
label{text-decoration:none;
color:#000;
}
.file-msg{
	font-size:12px;
}
#hidebox {
    display:none;
    width:160px;
    height:56px;
    position: absolute;
    top:40%;
    left:40%;
    line-height:56px;
    color:#fff;
    padding-left:60px;
    font-size:15px;
    background: #000  no-repeat 10px 50%;
    opacity: 0.7;
    z-index:9999;
    -moz-border-radius:20px;
    -webkit-border-radius:20px;
    border-radius:20px;
    filter:progid:DXImageTransform.Microsoft.Alpha(opacity=70);
}
    .main-frame{
        display: flex;
        display: -webkit-flex;
        align-items: center;
        flex-direction: column;
    }
.new-ver{ border:0px;
    border-bottom:#00BBFF 1px solid;
    color:#fff;
    background:#2cac93;
    width: 30px;
}
.new-sys{ border:0px;
    border-bottom:#00BBFF 1px solid;
    color:#fff;
    background:#2cac93;
    width: 40px;
}
.d-pool{
    display: -webkit-flex;
    display: flex;
    align-content: center;
    flex-wrap: wrap-reverse;
}
.tag-box{
    margin: 3px 3px 3px 3px;
    background:#2cac93;
    display: -webkit-inline-flex;
    display: inline-flex;
    flex-direction: column;
    border-radius: 5px;
}
.tag-by label{display: inline-block; padding:0 25px 0 8px; position: relative; margin:3px 4px; }
.d-down{display: inline-block; padding:0 5px 0 8px; position: relative; margin:3px 4px; }
.tag-by label em{display:none; width: 16px; height: 100%; position: absolute; background: #f60;right: 0;top: 0;}
.tag-by label em:after{ content: "x"; color: #fff; font: bold 20px 'Microsoft Yahei';}
.tag-by label:hover em{ display: block; }

.tag-by{
    display: inline-flex;
    display: -webkit-inline-flex;
    display: -webkit-flex;
    display: flex;
    flex-direction:row;
}
.path-box{
    display: -webkit-flex;
    display: flex;
    flex-wrap: wrap-reverse;
}
    .bs_ver{
        border: none;
        border-bottom: 1px solid #000;
        margin-left: 3px;
        width: 45px;
        text-align: center;
    }
    .label_ra{
        background:url(../../../images/label_1.png) no-repeat;
        width: 22px;
        height: 22px;

    }
    .label_div{




    }
    .onupload{
        width: 160%;
        display: flex;
        margin-top: 8px;
        margin-left: 8px;
    }
    .dis{
        
    }
    .file {
    position: relative;
    display: inline-block;
    background: #ccc;
    border: 1px solid #333;
    padding: 4px 20px;
    overflow: hidden;
    text-decoration: none;
    text-indent: 0;
    line-height: 20px;
    border-radius: 20px;
    color: #333;
    font-size: 13px;

}
.file input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
}

.gradient{

    filter:alpha(opacity=100 finishopacity=50 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr=#fff,endcolorstr=#ccc,gradientType=0);
    -ms-filter:alpha(opacity=100 finishopacity=50 style=1 startx=0,starty=0,finishx=0,finishy=150) progid:DXImageTransform.Microsoft.gradient(startcolorstr=#fff,endcolorstr=#ccc,gradientType=0);/*IE8*/
    background:#ccc; /* 一些不支持背景渐变的浏览器 */
    background:-moz-linear-gradient(top, #fff, #ccc);
    background:-webkit-gradient(linear, 0 0, 0 bottom, from(#fff), to(#ccc));
    background:-o-linear-gradient(top, #fff, #ccc);
}
.showFileName1{
    width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    word-break: break-all;
    margin-left: 110px;
    margin-top: -35px;
}

</style>

<script src="../../js/jquery-3.2.1.js"></script>
<script src="../../js/bootstrap.min.js"></script>
<link rel="stylesheet" href="../../css/bootstrap.min.css"/>

<script type="text/javascript">

function load(){
	$.ajax({
		type:'post',
		dataType:'json',
		url:"Controller.php",
		data:{action:'NPIController/getModel',flag:'NPI'},
		success:function(msg){
			//console.log(msg);
			var selections=document.getElementById('st-model');
			if(msg.length>0){
				for(var i=0;i<msg.length;i++){
					var option=document.createElement("option");
					option.value=msg[i]['model'];
					option.text=msg[i]['model'];
					selections.options.add(option);
				}
			}
		},
		error:function(msg){
			console.log(msg);
		}
	})
}

function submit(){
    let flag = 'NPI';
    let j=0;
    let st_group=document.getElementsByName("st_group"); //ftp input
    let st_arr=new Array();
    for (let i=0;i<st_group.length;i++){
        if (st_group[i].value.length>3) {
            //st_arr[st_group[i].id]=st_group[i].value;
           st_arr[j]=st_group[i].id.replace('-td','')+"_"+st_group[i].value;
           j++;
        }
    }
    console.log(st_arr);

    let tr=$('#model-tb').children("tr");
    if (tr.length==0){
        alert("not data");
        return false;
    }
    let model_obj=new Object();
    for (let i=0;i<tr.length;i++){
        let td=tr.eq(i).find('td');
        let model=tr.eq(i).find('td:eq(0)').text();
        //console.log(td.eq(4).find("input:eq(1)").val());
        let model_val=new Array();
        for (let x=1;x<td.length-1;x++){
            let model_ver=new Array();
            model_ver[0]=td.eq(x).find('input:eq(1)').val();
            model_val[x-1]=model_ver;
        }
        model_obj[model]=model_val;
    }
	let up=$('#st-up').val(),
	station=$('#staticstation').val(),

    npi_path='Attach',
	reason=$('#reason').val(),
	action="NPIController/Create",
	files=document.getElementById('sop-file').files,
	tprcheck=document.getElementsByName('tpr-box'),
    bdview = $('#bdinput').val();
    //change = $('#no-cg').val(),
	checkarr=new Array(),
    id=[];
    val = [];
	x=0;
    //console.log(change);
	for(var i=0;i<tprcheck.length;i++){
		if(tprcheck[i].checked){
			checkarr[x]=tprcheck[i].value;
			x++;
		}
	}
	var checkdata=checkarr.join(',');

    let model_json=JSON.stringify(model_obj);
    console.log(model_json);
    //console.log(files);
	let formdata=new FormData();
    if($('#no-cg').is(':checked')){
        change = 0;
    }else{
        change=1;
        $('.bs_ver').each(function(){
            if($(this).val()!==''){
                //console.log($(this).attr('id'));
                id.push($(this).attr('id'));
                val.push($(this).val());
            }
        })


    }
    console.log(id);
    console.log(val);
    formdata.append("flag",flag);
    formdata.append("action",action);
	formdata.append("up",up);
	formdata.append("station",station);

	formdata.append("reason",reason);
    formdata.append("npipath",npi_path);
	formdata.append("checkdata",checkdata);
    formdata.append("st_group",st_arr);
    formdata.append("model_json",model_json);
    formdata.append("change",change);
    formdata.append("id",id);
    formdata.append("val",val);
    if(bdview === ''){

    }else{
        formdata.append("bdview",bdview);
    }

    for (let x=0;x<files.length;x++){
        formdata.append("file"+x,files[x]);
    }
    //console.log(formdata.values());
	for (var value of formdata.values()) {
	    //console.log(value);
		if(value==""||value==undefined||value==" "){
			alert("please fill in all the data");
			return false;
		}
		}
	document.getElementById('hint-up').innerHTML="uploading";
	$.ajax({
		type:'post',
		dataType:'json',
		url:'Controller.php',
		contentType: false,
        processData: false,
        data:formdata,
        xhr:function(){
        	myxhr=$.ajaxSettings.xhr();
        	if(myxhr.upload){
        		myxhr.upload.addEventListener('progress',progressHander,false);
        	}
        	return myxhr;
        },

		  success: function(msg) {
	          console.log(msg);
	          if(msg[2]==1){
	        	  document.getElementById('hint-up').innerHTML="upload success";
                  document.getElementById('hint-up').style.color="green";
	          }else{
	        	  document.getElementById('hint-up').innerHTML="upload error";
                  document.getElementById('hint-up').style.color="red";
	          }
	          if(msg[0]=='1111'){
	        	  alert("Create success");
                  //console.log(reason);
	        	  Send_Mail(msg[1],msg[3],reason,msg[4]);//tpr,id,reason,model
	        	 // window.open("Shownpi.html","");
	          }else {
	        	  alert("error");
	          }
		  },
		  error:function(msg){
			  console.log(msg);
			  document.getElementById('hint-up').innerHTML="upload error";
		  }
	})

}
function progressHander(e){
	if(e.lengthComputable){
		if(e.total>1024*1024){
			var uploading=(Math.round(e.loaded * 100 / (1024 * 1024)) / 100).toString() + 'MB';
		}else{
			var uploading = (Math.round(e.loaded * 100 / 1024) / 100).toString() + 'KB';
		}
		document.getElementById('file-up').innerHTML=uploading;
		var persent=(e.loaded/e.total*100).toFixed(1);
		document.getElementById('probar').innerHTML=persent+"%";
		var probar=Math.floor(e.loaded/e.total*100)+'%';
		document.getElementById('probar').style.width=probar;
		//console.log(e.loaded+'----'+e.total);
	}
}
function Send_Mail(tpr,id,reason,model){
    let hint = document.getElementById('hint-up');
    show_dialog();
    let mail_msg=new Array();
    mail_msg[0]="C";
    mail_msg[1]=tpr;
	mail_msg[2]=id;
    mail_msg[3]=reason;
    mail_msg[4]='NPI';
    mail_msg[5]=model;
    console.log(mail_msg);
	$.ajax({
		type:'post',
		dataType:'json',
		url:"Controller.php",
		data:{action:'NPIController/SendMail',urldata:mail_msg},
		success:function(msg){
			console.log(msg);
            hidden_dialog();
			if(msg=='1111'){
				hint.innerHTML='send mail success!';
				hint.style.color="green";
				window.open("Shownpi.html","");
			}else{
			    alert('error');
                hint.innerHTML='send fail!';
                hint.style.color="red";
            }
		},
		error:function(msg){
			console.log(msg);
            hidden_dialog();
            alert("send error")
		}
		})
}
function fileselect(){
    let fileSize=0;
    let val=document.getElementById("st-up").value;
    //let file_obj = document.getElementById('sop-file').files[0];
    let files =  document.getElementById('sop-file').files;
    console.log(files);


    var fbom=document.getElementById('bom');
    //console.log(fbom.childNodes[1]);
    var ftp=document.getElementById('tp');
    var fct=document.getElementById('ct');
    var fcomt=document.getElementById('comt');
    var fgber=document.getElementById('gber');
    var fscil=document.getElementById('scil');
    var fprofile=document.getElementById('profile');
    var fnudd=document.getElementById('nudd');
    var fnpi=document.getElementById('npireport');

    let reg1 = new RegExp('Bom','i');
    let reg2 = new RegExp('part','i');
    let reg3 = new RegExp('Circuit','i');
    let reg4 = new RegExp('Components','i');
    let reg5 = new RegExp('Gerber','i');
    let reg6 = new RegExp('Stencil','i');
    let reg7 = new RegExp('Profile','i');
    let reg8 = new RegExp('NUDD','i');
    let reg9 = new RegExp('NPI','i');

    for(var i=0;i<files.length;i++){

        if (val==="NPI") {
            if((files[i]['name'].match(reg1))!==null){
                fbom.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg2))!==null){
                ftp.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg3))!==null){
                fct.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg4))!==null){
                fcomt.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg5))!==null){
                fgber.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg6))!==null){
                fscil.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg7))!==null){
                fprofile.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg8))!==null){
                fnudd.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }else if((files[i]['name'].match(reg9))!==null){
                fnpi.childNodes[1].style.background="url(../../../images/label_2.png) no-repeat";
            }
        }else{
            $('#sop').css('background-color','#1afa29');
        }

        fileSize+=files[i]['size'];

    }
    if(document.getElementById('sop-file').files[0]!=null){

    if(fileSize>1024*1024){
    	fileSize = (Math.round(fileSize * 100 / (1024 * 1024)) / 100).toString() + 'MB';
    }else {
        fileSize = (Math.round(fileSize * 100 / 1024) / 100).toString() + 'KB';
    }
    }else{
    	fileSize = null;
    }
    document.getElementById('file-size').innerHTML=fileSize;





}
function show_dialog(){
    document.getElementById("hidebox").style.display="block";
}
function hidden_dialog(){
    document.getElementById("hidebox").style.display="none";
}
function show_hint() {
    let val=document.getElementById("st-up").value;
    if (val==="NPI") {
        console.log($('div[class="dis"]').removeClass('dis'));
        $('#se1').children('input').eq(0).attr('disabled','disabled');
        $('#sop').css('background-color','#DBDBDB');
         $(".showFileName1").html("");
        document.getElementById('file-size').innerHTML = '';

    }else{
       if(!$('#dis1,#dis2').hasClass('dis')){
           $('#dis1,#dis2').addClass('dis');
           $('#se1').children('input').eq(0).removeAttr('disabled');
           $('#sop').css('background-color','#DBDBDB');
           $(".showFileName1").html("");
        document.getElementById('file-size').innerHTML = '';
       }
    }
}
function AddAll() {
    let tb=$('#model-tb');
    let model=$('#st-model').val();
    $.ajax({
        type:'post',
        dataType:'json',
        url:"Controller.php",
        data:{action:'NPIController/getMV'},
        success:function(msg){
            console.log(msg);
            for (let x=0;x<msg.length;x++){
                let a=0;
                $('#model-tb tr').each(function () {
                    let text=$(this).children("td:first").text();
                    if (text.indexOf(msg[x]['model'])!==-1){
                        a=1;
                    }
                })
                if (a==0){
                let model_td=$('<td id="'+msg[x]['model']+'">'+msg[x]['model']+'</td>');
                let tr=$('<tr></tr>');
                tb.append(tr);
                tr.append(model_td);
                if($('#no-cg').is(':checked')){
                    // alert("checked")
                    for(let i=1;i<6;i++){
                        let td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>not change</label></div><div><input type="text" class="bs_ver" value="'+msg[x][i]+'"/></div></div></td>');
                        tr.append(td);
                    }
                }else{
                    // alert("not checked")
                    for(let i=0;i<6;i++){
                        
                      
                        let td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div id=""><input type="text"  class="bs_ver"/></div></div></td>');

                        tr.append(td);
                    }
                }
                let del_td=$('<td><button type="button" onclick="del(this)" class="btn btn-danger">del</button></td>');
                tr.append(del_td);
            }
            }
        },
        error:function(msg){
            console.log(msg);
        }
    })
}
function Clean() {
    $('#model-tb tr:not(:first)').empty();

}
</script>
<style type="text/css">
body {
	background-image: url(../../../images/beijin.jpg);
}
</style>
</head>

<body onLoad="load()">
<nav class="nav" style="margin-left:30px;">
	<ul class="nav nav-tabs">
		<li class="nav-item">
			<a class="nav-link active" href="Shownpi.html" style="background-color: #cc6633">home</a>
		</li>
	</ul>
</nav>

<div id="hidebox" onClick="hide();" class="loading">Send mail……</div>

<div class="main-frame">
    <div style="display: -webkit-flex;display: flex;flex-direction: row;align-items:center;height: 65px;border: 1px solid #dee2e6;background-color: #ECECEC;width: 80%;border-bottom:none;">
        <div style=" border:1px solid #C6C6C6;border-radius: 3px;display: flex;justify-content: center;align-items: center;text-align: center;background-color: #E9ECEF;margin: 0 15px 0 15px;width: 60px;height: 35px;">
            <label style="color: #000;">Type</label>
        </div>
        <div >
            <select class="form-control" id="st-up" onChange="show_hint()" style="margin-left: 30px">
                <option>NPI</option>
               
            </select>
        </div>

    </div>

    <div style="display: flex;display: -webkit-flex;flex-direction: row;align-items:center;height: 85px;justify-content: space-between;border: 1px solid #dee2e6;background-color: #ECECEC;width: 80%;">
        <div style="display: flex;display: -webkit-flex;height: 100%;width: 10%;align-items:center;">
            <div style=" border:1px solid #C6C6C6;border-radius: 3px;display: flex;justify-content: center;align-items: center;text-align: center;background-color: #E9ECEF;margin: 0 15px 0 15px;width: 60px;height: 35px;">
                <label style="color: #000;">
                    Reason
                </label>
            </div>
        </div>
        <div style="height: 100%;width: 30%;text-align: center">
            <textarea  style="resize:none;border-radius: 3px;margin-right: 5px;width: 100%;height: 100%;" id="reason"></textarea>
        </div>
        <div style="display: flex;display: -webkit-flex;height: 100%;width: 10%;align-items:center;">
            <div style=" border:1px solid #C6C6C6;border-radius: 3px;display: flex;justify-content: center;align-items: center;text-align: center;background-color: #E9ECEF;margin: 0 15px 0 15px;width: 60px;height: 35px;">

                <label style="color: #000;">
                    TPR
                </label>
            </div>
        </div>
        <div style="display: flex;display: -webkit-flex;height: 100%;width: 50%;align-items:center;">
            <div style="display: -webkit-flex;display: flex;flex-direction: column;align-items:center;justify-content: space-between;width: 80%;height: 100%">
                <div id="se1" >
                    <input type="checkbox"  name="tpr-box" value="CGS">CGS</input>
                    <input type="checkbox" name="tpr-box" value="RLC_SH">RLC_SH</input>
                    <input type="checkbox" name="tpr-box" value="CEP">CEP</input>
                    <input type="checkbox" name="tpr-box" value="IGS">IGS</input>
              </div>
                <div >
                    <input type="checkbox" name="tpr-box" value="CEB">CEB</input>
                    <input type="checkbox" name="tpr-box" value="CSAT">TSI</input>
                    <input type="checkbox" name="tpr-box" value="RLC_INDIA">ICC-RLG</input>
                    <input type="checkbox" name="tpr-box" value="Regenersis_INDIA">CTDI</input>
                </div>

            </div>
        </div>
    </div>

    <div style="display: flex;display: -webkit-flex;flex-direction: row;align-items:center;border: 1px solid #dee2e6;background-color: #ECECEC;width: 80%;border-top: none;border-bottom: none;height: 230px;">

        <div style="width: 60%;border-right: 1px solid #BBB;display: flex;display: -webkit-flex;flex-direction: row;">

            <div style="width: 350%;display: flex;display: -webkit-flex;flex-direction: column;">
                <div style="display: flex;display: -webkit-flex;flex-direction: row;margin-top: 10px">
                    <div style=" border:1px solid #C6C6C6;border-radius: 3px;display: flex;justify-content: center;align-items: center;text-align: center;background-color: #E9ECEF;margin: 0 15px 0 15px;width: 80px;height: 35px;">
                        <label style="color: #000;">
                            upload
                        </label>
                    </div>
                    <div style="width: 350px;margin-left: 12px">
                        <a href="javascript:;" class="file gradient" style="text-decoration: none">选择文件
                            <input type="file" id="sop-file" multiple="multiple" onChange="fileselect()" style="width: 100%"/>
                            </a>
                            <div class="showFileName1"></div>
                    </div>
                    <div style="width: 20%;margin-left: 26px;margin-top: 4px">
                        <label id="file-up" class="file-msg">
                        </label>
                        <label>Size:/</label>
                        <label id="file-size" class="file-msg">
                        </label>
                    </div>
                </div>
                <div class="dis" id="dis1"  style="display: flex;flex-direction: row;justify-content: space-between;margin-left: 10px">
                    <div id="label_div" >
                        <div id="bom" class="onupload" >
                            <div class="label_ra" id="dbom"></div>
                            <span STYLE="margin-top:-4px;">BOM</span>
                        </div>
                        <div id="tp" class="onupload" >
                            <div class="label_ra" id="dtp"></div>
                            <span STYLE="margin-top:-4px;margin-left: 2px">Turn parts list</span>
                        </div>
                        <div id="ct" class="onupload" >
                            <div class="label_ra" id="dct"></div>
                            <span STYLE="margin-top:-4px;">Circuit</span>
                        </div>
                    </div>
                    <div class="label_div" >
                        <div id="comt" class="onupload" >
                            <div class="label_ra" id="dcomt"></div>
                            <span STYLE="margin-top:-4px;">Components list</span>
                        </div>
                        <div id="gber" class="onupload" >
                            <div class="label_ra" id="dgber"></div>
                            <span STYLE="margin-top:-4px;margin-left: 2px">Gerber</span>
                        </div>
                        <div id="scil" class="onupload" >
                            <div class="label_ra" id="dscil"></div>
                            <span STYLE="margin-top:-4px;">Stencil file</span>
                        </div>
                    </div>
                    <div class="label_div" >
                        <div id="profile" class="onupload" >
                            <div class="label_ra" id="dprofile"></div>
                            <span STYLE="margin-top:-4px;">Profile</span>
                        </div>
                        <div id="nudd" class="onupload" >
                            <div class="label_ra" id="dnudd"></div>
                            <span STYLE="margin-top:-4px;margin-left: 2px">NUDD</span>
                        </div>
                        <div id="npireport" class="onupload" >
                            <div class="label_ra" id="dreport"></div>
                            <span STYLE="margin-top:-4px;">NPI Report</span>
                        </div>
                    </div>
                </div>
                <div class="dis"  id="dis2" style="display: flex;display: -webkit-flex;flex-direction: row;width:100%;">
                    <div id="view" style="width: 16px;height: 16px;border-radius: 50%;background-color: #DBDBDB;margin-left: 17px;margin-top: 15px"></div>
                   <div style="margin-left: 8px;line-height: 40px">BoardviewPath:
                       <input placeholder="" id='bdinput' onchange="bdview()" style="border:none;border-bottom:1px solid #000;background-color:#ECECEC;height: 27px;margin-left: 9px"/>
                   </div>
                </div>
                

            </div>

            <div style="display: flex;display: -webkit-flex;flex-direction: column;align-items:center;width: 100%;margin-left: 15px">

                <div style="width: 100%;height: 50%">
                    <div class="progress" style="width: 90%">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" style="width:0" id="probar"></div>
                    </div>
                </div>
                <div style="display: -webkit-flex;display: flex;flex-direction:row;width: 100%;height: 50%;margin-top: 135px">


                </div>

            </div>


        </div>

        <div style="width: 20%;display: flex;display: -webkit-flex;flex-direction: row;align-items:center;justify-content: center">
            <label id="hint-up">
                none
            </label>
        </div>

    </div>

    <table class="table table-bordered" style="width: 80%;background-color: #ECECEC;">

        <tr style="height: 125px">
            <td style="width: 15%!important;">
                <div style="display: -webkit-flex;display: flex;flex-direction: row;margin-top: 20px">
                    <div style="margin-right: 15px">
                        <select id="st-station" class="form-control" style="width:120px">
                            <option value="QC1">QC1</option>
                            <option value="QC2">QC2</option>
                            <option value="RUNIN">RUNIN</option>
                            <option value="RUNIN2">RUNIN2</option>
                            <option value="QC3">QC3</option>
                            <option value="OBA">OBA</option>
                        </select>
                    </div>
                    <button type="button" class="btn btn-primary" id="add-station">add station</button>
                </div>

            </td>

            <td style="position: relative">
                <input type="text" name="staticPath" id="staticstation" style="width: 185px;margin-top: 2px" />
            </td>

        </tr>
        <tr>
            <td>
                <div style=" border:1px solid #C6C6C6;border-radius: 3px;display: flex;justify-content: center;align-items: center;text-align: center;background-color: #E9ECEF;margin: 0 15px 0 15px;width: 120px;height: 35px;">

                    <label style="color: #000;">
                        ProgramPath
                    </label>

                </div>


            </td>
            <td>
                <div class="path-box">
                <div class="input-group" style="width: 240px;margin: 3px 3px 3px 3px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text">QC1</span>
                    </div>
                    <input type="text" class="form-control" placeholder="FTP Path" id="QC1-td" name="st_group" disabled="disabled">
                </div>

                <div class="input-group" style="width: 240px;margin: 3px 3px 3px 3px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text">QC2</span>
                    </div>
                    <input type="text" class="form-control" placeholder="FTP Path" id="QC2-td" name="st_group" disabled="disabled">
                </div>

                <div class="input-group" style="width: 240px;margin: 3px 3px 3px 3px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text">RUNIN</span>
                    </div>
                    <input type="text" class="form-control" placeholder="FTP Path" id="RUNIN-td" name="st_group" disabled="disabled">
                </div>

                <div class="input-group" style="width: 240px;margin: 3px 3px 3px 3px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text">RUNIN2</span>
                    </div>
                    <input type="text" class="form-control" placeholder="FTP Path" id="RUNIN2-td" name="st_group" disabled="disabled">
                </div>

                <div class="input-group" style="width: 240px;margin: 3px 3px 3px 3px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text">QC3</span>
                    </div>
                    <input type="text" class="form-control" placeholder="FTP Path" id="QC3-td" name="st_group" disabled="disabled">
                </div>

                <div class="input-group" style="width: 240px;margin: 3px 3px 3px 3px;">
                    <div class="input-group-prepend">
                        <span class="input-group-text">OBA</span>
                    </div>
                    <input type="text" class="form-control" placeholder="FTP Path" id="OBA-td" name="st_group" disabled="disabled">
                </div>
                </div>
            </td>
        </tr>

        <tr>
            <td colspan="2">
                <div style="display: flex;display: -webkit-flex;justify-content: space-between">
                    <label class="form-check-label">
                        <input type="checkbox" name="new-box" value="1" id="no-cg" />not change
                    </label>
                    <button type="button" class="btn btn-primary" id="submit" onClick="submit()" style="margin-left: 15px">Create</button>
                </div>

            </td>
        </tr>
        <tr>
            <td colspan="2">
                <div style="display: -webkit-flex;display: flex;flex-direction: row">


                <div style="margin-left: 25px;width: 145px;height: 42px;display: -webkit-flex;display: flex;flex-direction: row;">
                    <select id="st-model" style="width:120px" class="form-control">
                    </select>
                    <button class="btn btn-primary" type="button" style="margin-left: 5px;" onClick="add_model()">
                        add
                    </button>
                </div>

                <div style="margin-left: 65px;width: 145px;height: 42px;display: -webkit-flex;display: flex;flex-direction: row;align-items: center">
                        <button class="btn btn-primary" type="button" onClick="AddAll()" style="margin-left: 5px;">
                            add all
                        </button>
                </div>

                    <div style="margin-left: 65px;width: 145px;height: 42px;display: -webkit-flex;display: flex;flex-direction: row;align-items: center">
                        <button class="btn btn-primary" type="button" onClick="Clean()" style="margin-left: 5px;">
                            clean
                        </button>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <table class="table table-bordered table-sm" id="model-tb">
                    <thead>
                    <tr>
                        <td>
                            Model
                        </td>
                        <td id="QC1">
                            QC1
                        </td>
                        <td id="QC2">
                            QC2
                        </td>
                        <td id="QC3">
                            QC3
                        </td>
                        <td id="OBA">
                            OBA
                        </td>
                        <td id="RUNIN">
                            RUNIN
                        </td>
                        <!--
                        <td id="RUNIN2">
                            RUNIN2
                        </td>
                        -->
                        <td>
                            del
                        </td>
                    </tr>
                    </thead>
                </table>
            </td>
        </tr>
    </table>
</div>
</body>
<script type="text/javascript">
 $(".file").on("change","input[type='file']",function(){
        var filePath=$(this).val();
        let files = document.getElementById('sop-file').files;
        //console.log(filePath.length);
        var arr=filePath.split('\\');
        var fileName=arr[arr.length-1];
        let tmp = filePath.split('.');
        let suffix = tmp[1];
        if(files.length>1&&fileName.length>30){
            fileName = fileName.substr(0,16)+'...';
            $(".showFileName1").html(fileName+'等文件');}
        else{
            if(fileName.length>30){
                fileName = fileName.substr(0,18)+'...'+suffix;
                $(".showFileName1").html(fileName);
            }else{
                $(".showFileName1").html(fileName);
            }

        }
    });
    function not_change(obj) {
        let b_img=obj.parentNode.parentNode.parentNode.parentNode.parentNode.childNodes[1].innerText;

        let in_img=obj.parentNode.parentNode.parentNode.childNodes[1].childNodes[0];
        in_img.value="";

    }

    function bdview() {
        let text = $('#bdinput').val();
        if(text!==''){
            $('#view').css('background-color','#1afa29')
        }else{
            $('#view').css('background-color','#DBDBDB')
        }
    }
    function fillall(sid,svalue){
            console.log(sid);
            console.log(svalue);
           // console.log($(this).val());
            
        let dom  = $('input[name='+sid+']').not(':first').each(function(){
            console.log($(this));
            $(this).val(svalue);
           
        });
       // console.log(dom);
    }

    function add_model() {
        let tb=$('#model-tb');
        let model=$('#st-model').val();
        let cols="";
        $('#model-tb tr').each(function () {
            let text=$(this).children("td:first").text();
            cols+=text+",";
        })
        if (cols.indexOf(model)!==-1){
            alert("already add model");
            return false;
        }
        $.ajax({
            type:'post',
            dataType:'json',
            url:"Controller.php",
            data:{action:'NPIController/getVer',urldata:model},
            success:function(msg){
                console.log(msg);
                if(msg==1){
                    alert('NPI数据库查无此机种，正在更新数据表，请稍后再试！');
                    return '';
                }
                let model_td=$('<td id="'+msg['model']+'">'+msg['model']+'</td>');
                id=['QC1','QC2','QC3','OBA','RUNIN']
                let tr=$('<tr></tr>');
                tb.append(tr);
                tr.append(model_td);
                if($('#no-cg').is(':checked')){
                    // alert("checked")
                    for(let i=1;i<6;i++){
                        let td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" class="bs_ver" value="'+msg[i]+'"/></div></div></td>');
                        tr.append(td);
                    }
                }else{
                    let itext = [];
                   
                    $lb  = $('.words-split').children('label').each(function(){
                       // console.log($(this)[0].innerText);
                       itext.push($(this)[0].innerText);
                    });
                    console.log(itext);
                    //console.log( itext.indexOf('QC1') );  
                    // alert("not checked")
                    for(let i=0;i<5;i++){
                        let td = '';
                        
                          
                            if(itext.indexOf('QC1') >-1){
                                console.log(0);
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" name='+id[i]+' onchange="fillall($(this)[0].name,$(this)[0].value)" class="bs_ver"/></div></div></td>');
                             tr.append(td);
                            }else{
                             
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" id='+id[i]+' class="bs_ver" value="/"  readonly="true" /></div></div></td>');
                             tr.append(td);
                                }
                      
                        if(i=1){
                            console.log(11);
                            if(itext.indexOf('QC2') >-1){
                            console.log(1);
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" name='+id[i]+' onchange="fillall($(this)[0].name,$(this)[0].value)"  class="bs_ver"/></div></div></td>');
                             tr.append(td);
                            }else{
                            
                            td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" id='+id[i]+' class="bs_ver" value="/" readonly="true"  /></div></div></td>');
                            tr.append(td);
                                }
                        }
                        if(i=2){
                            console.log(22);
                            if(itext.indexOf('QC3') >-1){
                            console.log(2);
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" name='+id[i]+' onchange="fillall($(this)[0].name,$(this)[0].value)"  class="bs_ver"/></div></div></td>');
                             tr.append(td);
                            }else{
                            
                            td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" id='+id[i]+' class="bs_ver" value="/" readonly="true"  /></div></div></td>');
                            tr.append(td);
                                 }
                        }
                        if(i=3){
                            console.log(33);
                            if(itext.indexOf('OBA') >-1){
                            console.log(3);
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" name='+id[i]+' onchange="fillall($(this)[0].name,$(this)[0].value)"  class="bs_ver"/></div></div></td>');
                             tr.append(td);
                            }else{
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" id='+id[i]+' class="bs_ver" value="/"  readonly="true"/></div></div></td>');
                             tr.append(td);
                                }
                        }
                        if(i=4){
                            console.log(44);
                            if(itext.indexOf('RUNIN') >-1){
                            console.log(4);
                             td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" name='+id[i]+' onchange="fillall($(this)[0].name,$(this)[0].value)" class="bs_ver"/></div></div></td>');
                            tr.append(td);
                            }else{
                                td=$('<td><div><div><label style="background-color: #00BBFF;padding: 0px 5px 3px 5px;border-radius: 5px;"><input type="checkbox" onclick="not_change(this)"/>clean</label></div><div><input type="text" id='+id[i]+' class="bs_ver" value="/"  readonly="true"/></div></div></td>');
                                tr.append(td);
                                }
                        }
                        
                       
                    }
                }
                let del_td=$('<td><button type="button" onclick="del(this)" class="btn btn-danger">del</button></td>');
                tr.append(del_td);
            },
            error:function(msg){
                console.log(msg);
            }
        })

    }
    function del(obj) {
        obj.parentNode.parentNode.remove();
    }
    


    var ST=function (opt){
        var el=$(opt.el),
            holder = $('<span class="words-split"></span>'),
            add=$('#add-station');
            el.hide().after( holder );//隐藏input #staticstation后 插入span after() 方法在被选元素后插入指定的内容。

        holder.on('click','label>em',function(){	//刪除
            let l=$(this).parent().text().replace(" ", "");
            document.getElementById(l+'-td').value="";
            document.getElementById(l+'-td').setAttribute("disabled","disabled");
            $(this).parent().remove();
            if (holder.text()!="") {
                el.val(holder.text().match(/\S+/g).join(','));
            }

        });

        add.on('click',function(){
            var v = $("#st-station").val();
            console.log(v);
            if($('#staticstation').val().indexOf(v)!==-1){
                alert("already add");
                return;
            }else{
                holder.append( $('<label class="station-lb" name="n-model">'+v+'<em> </em></label>') );
                el.val( holder.text().match(/\S+/g).join(',') );
                document.getElementById(v+'-td').disabled=false;
            }
        });
    };

    ST({el:'#staticstation'});


</script>
</html>
